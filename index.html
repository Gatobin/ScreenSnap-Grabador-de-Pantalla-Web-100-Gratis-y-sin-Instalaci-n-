<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Grabador de Pantalla</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Montserrat', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 1s ease',
            'blink': 'blink 1s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0, transform: 'translateY(40px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' },
            },
            blink: {
              '0%, 100%': { opacity: 1 },
              '50%': { opacity: 0.3 },
            }
          },
        }
      }
    }
  </script>
  <style>
    .text-shadow {
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-[#23232a] to-[#4f46e5] text-[#f3f3f3] min-h-screen m-0 flex flex-col justify-center items-center">
  <div class="bg-[#23232aee] rounded-[22px] shadow-[0_8px_32px_0_rgba(31,38,135,0.37)] pt-12 px-9 pb-9 w-[370px] text-center relative border border-[#4f46e5] animate-fade-in">
    <h1 class="text-2xl md:text-3xl font-bold mb-5 tracking-wide text-[#e0e0e0] text-shadow">Grabador de Pantalla</h1>
    <div class="mt-5 mb-3 text-base text-[#bdbdbd] min-h-[26px] tracking-wide flex items-center justify-center gap-2" id="recordingInfo">
      <span id="statusText">Listo para grabar pantalla y micrófono</span>
    </div>
    <button class="py-3.5 px-8 text-lg font-medium mb-3 border-0 rounded-xl bg-gradient-to-r from-[#4f46e5] to-[#23232a] text-[#f3f3f3] cursor-pointer transition-all duration-200 ease-in-out shadow-[0_2px_8px_#0002] outline-none hover:bg-gradient-to-r hover:from-[#6366f1] hover:to-[#23232a] hover:scale-106 disabled:bg-[#44444c] disabled:text-[#aaa] disabled:cursor-not-allowed" id="startBtn">Iniciar Grabación</button>
    <button class="py-3.5 px-8 text-lg font-medium mb-3 border-0 rounded-xl bg-gradient-to-r from-[#4f46e5] to-[#23232a] text-[#f3f3f3] cursor-pointer transition-all duration-200 ease-in-out shadow-[0_2px_8px_#0002] outline-none hover:bg-gradient-to-r hover:from-[#6366f1] hover:to-[#23232a] hover:scale-106 disabled:bg-[#44444c] disabled:text-[#aaa] disabled:cursor-not-allowed" id="stopBtn" disabled>Detener y Descargar</button>
  </div>
  <div class="mt-11 text-base text-[#ddd] text-center tracking-wider w-full pb-5 opacity-90">
    <span class="text-shadow font-bold tracking-widest">ForceTeam</span>
  </div>

  <script>
    let mediaRecorder;
    let recordedChunks = [];
    let sizeInterval;
    let totalBytes = 0;

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const statusText = document.getElementById("statusText");

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
      if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
    }

    startBtn.onclick = async () => {
      try {
        const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
        let micStream;
        try {
          micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        } catch (e) {
          micStream = null;
        }

        let tracks = [...screenStream.getVideoTracks()];
        let audioTracks = [];
        if (screenStream.getAudioTracks().length) audioTracks.push(...screenStream.getAudioTracks());
        if (micStream && micStream.getAudioTracks().length) audioTracks.push(...micStream.getAudioTracks());
        tracks = tracks.concat(audioTracks);

        const mixedStream = new MediaStream(tracks);

        recordedChunks = [];
        totalBytes = 0;
        mediaRecorder = new MediaRecorder(mixedStream);

        mediaRecorder.ondataavailable = event => {
          if (event.data.size > 0) {
            recordedChunks.push(event.data);
            totalBytes += event.data.size;
          }
        };

        mediaRecorder.onstart = () => {
          statusText.innerHTML = '<span class="w-3 h-3 rounded-full bg-red-500 animate-blink inline-block align-middle"></span> Grabando... (' + formatBytes(totalBytes) + ')';
          sizeInterval = setInterval(() => {
            statusText.innerHTML = '<span class="w-3 h-3 rounded-full bg-red-500 animate-blink inline-block align-middle"></span> Grabando... (' + formatBytes(totalBytes) + ')';
          }, 500);
        };

        mediaRecorder.onstop = () => {
          clearInterval(sizeInterval);
          statusText.textContent = 'Grabación finalizada (' + formatBytes(totalBytes) + ')';
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "grabacion.webm";
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, 100);
        };

        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
      } catch (err) {
        statusText.textContent = 'Permiso denegado o error: ' + err.message;
      }
    };

    stopBtn.onclick = () => {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    };
  </script>
</body>
</html>
